import React, { useCallback, useState } from "react";
// import { Button } from "@/components/kit";
import { Text } from "@/components/kit/Text/Text";

interface SearchInputProps {
  value: string;
  onChange: (value: string) => void;
  onSearch?: (value: string) => void;
  placeholder?: string;
  className?: string;
}

export const SearchInput: React.FC<SearchInputProps> = ({
  value,
  onChange,
  onSearch,
  placeholder = "Search...",
  className = "",
}) => {
  const [focused, setFocused] = useState(false);

  const isFilled = value.trim().length > 0;

  const handleKeyDown = useCallback(
    (e: React.KeyboardEvent<HTMLInputElement>) => {
      if (e.key === "Enter" && onSearch) {
        onSearch(value.trim());
      }
    },
    [onSearch, value],
  );

  return (
    <div className={`flex items-center gap-2 ${className}`}>
      <div
        className={`bg-section-bg flex h-11 w-full items-center gap-2 rounded-xl px-2.5 py-[7px]`}
      >
        {/* Search icon */}
        <div className="text-hint">
          <svg
            width="22"
            height="22"
            viewBox="0 0 22 22"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M2.89062 9.44629C2.89062 8.5332 3.06217 7.67822 3.40527 6.88135C3.74837 6.07894 4.22428 5.37337 4.83301 4.76465C5.44173 4.15592 6.14453 3.68001 6.94141 3.33691C7.74381 2.99382 8.60156 2.82227 9.51465 2.82227C10.4277 2.82227 11.2827 2.99382 12.0796 3.33691C12.882 3.68001 13.5876 4.15592 14.1963 4.76465C14.805 5.37337 15.2809 6.07894 15.624 6.88135C15.9671 7.67822 16.1387 8.5332 16.1387 9.44629C16.1387 10.2044 16.0169 10.9238 15.7734 11.6045C15.5355 12.2852 15.2035 12.9022 14.7773 13.4556L18.8364 17.5396C18.925 17.6281 18.9914 17.7305 19.0356 17.8467C19.0854 17.9629 19.1104 18.0874 19.1104 18.2202C19.1104 18.4028 19.0688 18.5688 18.9858 18.7183C18.9084 18.8677 18.7977 18.9839 18.6538 19.0669C18.5099 19.1554 18.3439 19.1997 18.1558 19.1997C18.0229 19.1997 17.8957 19.1748 17.7739 19.125C17.6577 19.0807 17.5498 19.0116 17.4502 18.9175L13.3662 14.8252C12.8239 15.2126 12.2262 15.5169 11.5732 15.7383C10.9202 15.9596 10.234 16.0703 9.51465 16.0703C8.60156 16.0703 7.74381 15.8988 6.94141 15.5557C6.14453 15.2126 5.44173 14.7367 4.83301 14.1279C4.22428 13.5192 3.74837 12.8164 3.40527 12.0195C3.06217 11.2171 2.89062 10.3594 2.89062 9.44629ZM4.31006 9.44629C4.31006 10.1657 4.44287 10.8408 4.7085 11.4717C4.97966 12.097 5.35319 12.6476 5.8291 13.1235C6.31055 13.5994 6.86393 13.973 7.48926 14.2441C8.12012 14.5153 8.79525 14.6509 9.51465 14.6509C10.234 14.6509 10.9064 14.5153 11.5317 14.2441C12.1626 13.973 12.716 13.5994 13.1919 13.1235C13.6678 12.6476 14.0413 12.097 14.3125 11.4717C14.5837 10.8408 14.7192 10.1657 14.7192 9.44629C14.7192 8.72689 14.5837 8.05452 14.3125 7.4292C14.0413 6.79834 13.6678 6.24495 13.1919 5.76904C12.716 5.2876 12.1626 4.91406 11.5317 4.64844C10.9064 4.37728 10.234 4.2417 9.51465 4.2417C8.79525 4.2417 8.12012 4.37728 7.48926 4.64844C6.86393 4.91406 6.31055 5.2876 5.8291 5.76904C5.35319 6.24495 4.97966 6.79834 4.7085 7.4292C4.44287 8.05452 4.31006 8.72689 4.31006 9.44629Z"
              fill="currentColor"
            />
          </svg>
        </div>

        <input
          value={value}
          onChange={(e) => onChange(e.target.value)}
          onKeyDown={handleKeyDown}
          onFocus={() => setFocused(true)}
          onBlur={() => setFocused(false)}
          placeholder={placeholder}
          className="placeholder:text-hint flex-1 bg-transparent outline-none"
          inputMode="search"
          autoCorrect="off"
          spellCheck={false}
        />

        {(isFilled || focused) && (
          <button
            aria-label="Clear"
            className="text-hint"
            onClick={(e) => {
              e.stopPropagation();
              onChange("");
            }}
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clip-path="url(#clip0_889_54733)">
                <g clip-path="url(#clip1_889_54733)">
                  <path
                    d="M8 16C6.90719 16 5.87712 15.7908 4.9098 15.3725C3.94771 14.9542 3.09804 14.3765 2.36078 13.6392C1.62353 12.902 1.04575 12.0523 0.627451 11.0902C0.20915 10.1229 0 9.09281 0 8C0 6.90719 0.20915 5.87974 0.627451 4.91765C1.04575 3.95033 1.62092 3.09804 2.35294 2.36078C3.0902 1.62353 3.93987 1.04575 4.90196 0.627451C5.86928 0.20915 6.89935 0 7.99216 0C9.08497 0 10.115 0.20915 11.0824 0.627451C12.0497 1.04575 12.902 1.62353 13.6392 2.36078C14.3765 3.09804 14.9542 3.95033 15.3725 4.91765C15.7908 5.87974 16 6.90719 16 8C16 9.09281 15.7908 10.1229 15.3725 11.0902C14.9542 12.0523 14.3765 12.902 13.6392 13.6392C12.902 14.3765 12.0497 14.9542 11.0824 15.3725C10.1203 15.7908 9.09281 16 8 16ZM5.36471 11.2941C5.55294 11.2941 5.71242 11.2314 5.84314 11.1059L8.00784 8.92549L10.1804 11.1059C10.3007 11.2314 10.4549 11.2941 10.6431 11.2941C10.8261 11.2941 10.9804 11.2314 11.1059 11.1059C11.2314 10.9752 11.2941 10.8209 11.2941 10.6431C11.2941 10.4497 11.2314 10.2954 11.1059 10.1804L8.92549 8.00784L11.1137 5.82745C11.2392 5.69673 11.302 5.54248 11.302 5.36471C11.302 5.18693 11.2392 5.03529 11.1137 4.9098C10.9882 4.78431 10.8366 4.72157 10.6588 4.72157C10.4863 4.72157 10.3373 4.78431 10.2118 4.9098L8.00784 7.09804L5.81961 4.91765C5.68889 4.79739 5.53725 4.73725 5.36471 4.73725C5.18693 4.73725 5.03529 4.8 4.9098 4.92549C4.78431 5.04575 4.72157 5.19739 4.72157 5.38039C4.72157 5.55294 4.78431 5.70458 4.9098 5.83529L7.0902 8.00784L4.9098 10.1882C4.78431 10.3137 4.72157 10.4654 4.72157 10.6431C4.72157 10.8209 4.78431 10.9752 4.9098 11.1059C5.03529 11.2314 5.18693 11.2941 5.36471 11.2941Z"
                    fill="currentColor"
                  />
                </g>
              </g>
              <defs>
                <clipPath id="clip0_889_54733">
                  <rect width="16" height="16" fill="white" />
                </clipPath>
                <clipPath id="clip1_889_54733">
                  <rect width="16" height="16" fill="white" />
                </clipPath>
              </defs>
            </svg>
          </button>
        )}

        {isFilled && (
          <button
            aria-label="Search"
            className="text-text-overlay bg-primary-background rounded-[30px] px-2.5 py-[5px]"
            onClick={() => {
              if (onSearch) {
                onSearch(value.trim());
              }
            }}
          >
            <Text type="subheadline1" color="overlay" weight="semibold">
              Search
            </Text>
          </button>
        )}
      </div>
    </div>
  );
};
